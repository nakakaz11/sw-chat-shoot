// Generated by CoffeeScript 1.3.3

jQuery(function($) {
  var f, _socket, _userMap;
  _socket = io.connect();
  _userMap = {};
  _socket.on("data-send", function(data) {
    var date, user;
    date = new Date();
    if (_userMap[data.userId] === undefined) {
      console.log("SW-createUser:" + data.userId, data.message);
      user = {
        userId: data.userId
      };
      user.element = $("<dt>" + date + "</dt><dd>" + data.message + "</dd>").attr("data-user-id", user.userId);
      return $("#list").prepend(user.element);
    } else {
      user = _userMap[data.userId];
      user.element = $("<dt>" + date + "</dt><dd>" + data.message + "</dd>").attr("data-user-id", user.userId);
      return $("#list").prepend(user.element);
    }
  });
  /*  DB仕込むときにはfs使って入れるかな〜
  _socket.on "data updateDB", (data) ->
    console.log data
  */

  _socket.on("disconnected", function(data) {
    var user;
    user = _userMap[data.userId];
    if (user !== undefined) {
      return user.element.remove();
    }
  });
  f = function() {
    var msg;
    msg = $("input#message").val();
    $("input#message").val("");
    return _socket.emit("data-send", msg);
  };
  return $("button#btn").click(function() {
    return setTimeout(f, 30);
  });
});
