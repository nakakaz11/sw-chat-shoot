// Generated by CoffeeScript 1.4.0

jQuery(function($) {
  var _socket, _userMap;
  _socket = io.connect();
  _userMap = {};
  _socket.on("data-send", function(data) {
    var date, user;
    date = new Date();
    if (_userMap[data.userId] === undefined) {
      console.log("SW-createUser:" + data.userId, data);
      user = {
        userId: data.userId
      };
      return $("#list").prepend($("<dt>" + date + "</dt><dd>" + data + "</dd>").attr("data-user-id", user.userId));
    } else {
      user = _userMap[data.userId];
      return $("#list").prepend($("<dt>" + date + "</dt><dd>" + data + "</dd>").attr("data-user-id", user.userId));
    }
  });
  /*  DB仕込むときにはfs使って入れるかな〜
  _socket.on "data updateDB", (data) ->
    console.log data
  */

  _socket.on("disconnected", function(data) {
    var user;
    user = _userMap[data.userId];
    if (user !== undefined) {
      return user.element.remove();
    }
  });
  return $("button#btn").click(function() {
    var msg;
    msg = $("input#message").val();
    $("input#message").val("");
    return _socket.emit("data-send", {
      message: msg
    });
  });
});
